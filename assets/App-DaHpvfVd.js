import{j as e,a as R,u as S,c as z,b as E,A as f}from"./main-69QiOEEr.js";import{r as d}from"./state-DOKsaQ-a.js";import{R as G,T as H,c as T,d as O,e as _,f as A}from"./ui-BKD9s6Oq.js";import{u as $}from"./index-CN0gSnF3.js";import"./vendor-CZvkgD4c.js";function D({children:r,oauthServiceUrl:t,onAuthChange:o,isAuthenticated:i}){const[n,a]=d.useState(!0),[l,u]=d.useState(!1);return d.useEffect(()=>{const s=document.createElement("script");return s.src=`${t}/github-auth.js?v=${Date.now()}`,s.async=!0,s.onload=()=>{setTimeout(()=>{window.GitHubAuth?u(!0):(console.error("GitHubAuth not available after script load"),a(!1))},100)},s.onerror=()=>{console.error("Failed to load OAuth script"),a(!1)},document.head.appendChild(s),()=>{document.head.contains(s)&&document.head.removeChild(s)}},[t]),d.useEffect(()=>{if(l)if(window.GitHubAuth.isAuthenticated()){const s=window.GitHubAuth.getUser(),x=window.GitHubAuth.getToken();s&&x&&setTimeout(()=>{o(x,s),a(!1)},0)}else window.GitHubAuth.init({scope:"repo",onLogin:s=>{const x=window.GitHubAuth.getUser();x&&setTimeout(()=>{o(s,x),a(!1)},0)}}),a(!1)},[l,o]),n?e.jsx("div",{className:"loading",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{border:"4px solid rgba(255,255,255,0.3)",borderRadius:"50%",borderTopColor:"white",width:"50px",height:"50px",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),e.jsx("p",{children:"Initializing..."})]})}):i?e.jsx(e.Fragment,{children:r}):e.jsx("div",{className:"loading",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{children:"Authentication Required"}),e.jsx("p",{style:{marginTop:16,marginBottom:24,opacity:.9},children:"Please sign in with GitHub to access the gallery"}),e.jsx("button",{onClick:()=>window.GitHubAuth.login(),style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:"pointer"},children:"Sign in with GitHub"})]})})}function w({user:r,onLogout:t,onClearCache:o}){const[i,n]=d.useState(!1),a=d.useRef(null);d.useEffect(()=>{function u(s){a.current&&!a.current.contains(s.target)&&n(!1)}return document.addEventListener("click",u),()=>document.removeEventListener("click",u)},[]);const l=()=>{confirm("Clear all cached data? Apps will reload from the repository.")&&(o(),window.location.reload())};return r?e.jsxs("div",{ref:a,className:"fixed top-6 right-6 z-50",children:[e.jsxs("button",{onClick:()=>n(!i),className:"flex items-center gap-3 bg-white/80 backdrop-blur-md border border-neutral-200 rounded-full px-4 py-2 hover:bg-white transition-all duration-200 shadow-sm",children:[e.jsx("img",{src:r.avatar_url,alt:r.login,className:"w-8 h-8 rounded-full ring-2 ring-white"}),e.jsx("span",{className:"text-sm font-medium text-neutral-900",children:r.name||r.login})]}),e.jsxs("div",{className:`absolute top-14 right-0 bg-white border border-neutral-200 rounded-2xl shadow-xl min-w-[200px] overflow-hidden transition-all duration-200 ${i?"opacity-100 visible translate-y-0":"opacity-0 invisible -translate-y-2"}`,children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 transition-colors",children:[e.jsx(G,{size:16})," Refresh"]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 transition-colors border-t border-neutral-100",children:[e.jsx(H,{size:16})," Clear Cache"]}),e.jsxs("button",{onClick:t,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors border-t border-neutral-100",children:[e.jsx(T,{size:16})," Logout"]})]})]}):null}function I(r,t){if(!r?.minLauncherVersion||!t)return null;const o=t.split(".").map(Number),i=r.minLauncherVersion.split(".").map(Number);for(let n=0;n<3;n++){if(o[n]<i[n])return`Requires launcher v${r.minLauncherVersion}`;if(o[n]>i[n])return null}return null}function U({appName:r,manifest:t,path:o,onLaunch:i,version:n}){if(!t)return e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-900 mb-2",children:r}),e.jsx("p",{className:"text-neutral-400",children:"Loading..."})]})});const a=I(t,n);return e.jsxs("div",{className:"bg-white rounded-xl border border-neutral-200 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200 overflow-hidden group flex flex-col h-full",children:[e.jsx("div",{className:`w-full bg-gradient-to-br from-brand-50 to-neutral-50 flex items-center justify-center ${t.thumbnail?"h-32":"h-20"}`,children:t.thumbnail?e.jsx("img",{src:t.thumbnail,alt:t.name,className:"w-full h-full object-cover",onError:l=>{l.currentTarget.style.display="none"}}):e.jsx("div",{className:"text-4xl text-neutral-400",children:t.name.charAt(0)})}),e.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-neutral-900 mb-1",children:t.name}),e.jsx("p",{className:"text-neutral-600 text-xs leading-relaxed mb-3 line-clamp-2",children:t.description}),a&&e.jsxs("div",{className:"flex items-center gap-1.5 text-amber-600 text-xs mb-3 bg-amber-50 px-2 py-1.5 rounded",children:[e.jsx(O,{size:12}),e.jsx("span",{className:"text-[10px]",children:a})]}),t.tech&&t.tech.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mb-3",children:t.tech.map(l=>e.jsx("span",{className:"bg-neutral-100 text-neutral-700 px-2 py-0.5 rounded-full text-[10px] font-medium",children:l},l))}),e.jsxs("button",{onClick:()=>i(o,t.name),className:"inline-flex items-center justify-center gap-1.5 bg-gradient-to-r from-brand-600 to-brand-700 hover:from-brand-700 hover:to-brand-800 text-white px-3 py-2 rounded-lg font-medium text-xs transition-all duration-200 group-hover:gap-2 mt-auto",children:["Launch App",e.jsx(_,{size:14,className:"transition-transform duration-200"})]})]})]})}function q({config:r,user:t,useGitHubAPI:o,onLogout:i,onClearCache:n,onTrack:a,onNavigate:l}){const[u,s]=d.useState([]),[x,b]=d.useState(!0),[v,C]=d.useState(null),N=o(r.repository.owner,r.repository.name);d.useEffect(()=>{k()},[]);const k=async()=>{try{b(!0);const h=(await N.listDirectory("apps")).filter(c=>c.type==="dir"),p=h.map(c=>({name:c.name,path:c.path,manifest:null}));s(p);for(let c=0;c<h.length;c++){await new Promise(g=>setTimeout(g,c*100));const y=await N.getManifest(h[c].path);y&&s(g=>g.map(j=>j.name===h[c].name?{...j,manifest:y}:j))}b(!1)}catch(m){C(m.message),b(!1)}},L=d.useCallback((m,h)=>{a?.("app_launch",{appName:h,appPath:m});const p=u.find(c=>c.path===m)?.manifest;p?.reactRoute&&l&&l(p.reactRoute)},[u,a,l]);return x&&u.length===0?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed top-[70%] left-[75%] -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] sm:w-[600px] sm:h-[600px] rounded-full bg-brand-500 blur-[100px] sm:blur-[150px] opacity-40 animate-breathe pointer-events-none"}),e.jsx(w,{user:t,onLogout:i,onClearCache:n}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("header",{className:"py-16 sm:py-24 text-center",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-semibold text-neutral-900 flex items-center justify-center gap-3 mb-3",children:[e.jsx(A,{className:"text-brand-600",size:40}),r.branding.title]}),e.jsx("p",{className:"text-lg text-neutral-600 max-w-2xl mx-auto px-4",children:r.branding.subtitle})]}),e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-neutral-200 border-t-brand-600 rounded-full animate-[spin_1s_linear_infinite]"}),e.jsx("p",{className:"text-neutral-600",children:"Loading applications..."})]})})]})]}):v?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx(w,{user:t,onLogout:i,onClearCache:n}),e.jsx("div",{className:"container py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-xl p-6",children:[e.jsx("strong",{className:"font-semibold",children:"Error:"})," ",v]})})]}):e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed top-[70%] left-[75%] -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] sm:w-[600px] sm:h-[600px] rounded-full bg-brand-500 blur-[100px] sm:blur-[150px] opacity-40 animate-breathe pointer-events-none"}),e.jsx(w,{user:t,onLogout:i,onClearCache:n}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("header",{className:"py-16 sm:py-24 text-center",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-semibold text-neutral-900 flex items-center justify-center gap-3 mb-3",children:[e.jsx(A,{className:"text-brand-600",size:40}),r.branding.title]}),e.jsx("p",{className:"text-lg text-neutral-600 max-w-2xl mx-auto px-4",children:r.branding.subtitle})]}),e.jsx("div",{className:"container pb-20",children:e.jsx("div",{className:"grid",children:u.map(m=>e.jsx(U,{appName:m.name,manifest:m.manifest,path:m.path,onLaunch:L},m.name))})})]})]})}function B(){const r=R(),{user:t,token:o,isAuthenticated:i,setAuth:n,logout:a}=S(),{clearCache:l}=z(),{track:u}=E();return e.jsx(D,{oauthServiceUrl:f.oauth.serviceUrl,onAuthChange:(s,x)=>{s&&x&&n(s,x)},isAuthenticated:i,children:e.jsx(q,{config:f,user:t,token:o,useGitHubAPI:$,onLogout:a,onClearCache:()=>l(f.repository.owner,f.repository.name),onTrack:u,onNavigate:s=>r(s)})})}export{B as default};
