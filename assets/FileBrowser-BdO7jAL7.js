import{j as e,r as l,F as y,g as w}from"./react-vendor-CNslD6Mb.js";import{u as F}from"./index-CvKjxvKq.js";import{u as S}from"./usePerformanceMonitor-BOTvTF-c.js";import{A as j}from"./index-BafjOvf5.js";import"./vendor-7OC5HNn7.js";import"./state-CWLQzQDb.js";function E({currentPath:t,onNavigate:n}){const s=[{name:"root",path:""}];if(t){const r=t.split("/").filter(Boolean);let o="";for(const a of r)o=o?`${o}/${a}`:a,s.push({name:a,path:o})}return e.jsx("div",{className:"flex items-center gap-2 px-4 py-3 mb-4 bg-white rounded-lg border border-neutral-200 text-sm",children:s.map((r,o)=>e.jsxs("span",{className:"flex items-center gap-2",children:[o>0&&e.jsx("span",{className:"text-neutral-400",children:"/"}),e.jsx("a",{href:"#",onClick:a=>{a.preventDefault(),n(r.path)},className:"text-brand-600 hover:text-brand-700 hover:underline transition-colors",children:r.name})]},r.path))})}function I(t){return t?t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`:""}function L(t){return[...t].sort((n,s)=>n.type===s.type?n.name.localeCompare(s.name):n.type==="dir"?-1:1)}const g=l.memo(({file:t,onNavigate:n,style:s})=>{const r=t.type==="dir",o=r?e.jsx(y,{size:20}):e.jsx(w,{size:20}),a=r?"":I(t.size),c=()=>{r&&n(t.path)};return e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 border-b border-neutral-100 last:border-b-0 ${r?"cursor-pointer hover:bg-neutral-50 transition-colors":""}`,onClick:c,style:s,children:[e.jsx("span",{className:`flex-shrink-0 ${r?"text-brand-600":"text-neutral-400"}`,children:o}),e.jsx("span",{className:"flex-1 text-sm text-neutral-900 truncate",children:t.name}),a&&e.jsx("span",{className:"flex-shrink-0 text-xs text-neutral-500",children:a})]})});g.displayName="FileListItem";const u=56,v=5,C=l.memo(function({file:n,index:s,onNavigate:r}){return e.jsx(g,{file:n,onNavigate:r,style:{position:"absolute",top:s*u,left:0,right:0,height:u}})});function T({files:t,onNavigate:n}){const s=l.useRef(null),[r,o]=l.useState(0),[a,c]=l.useState(600);l.useEffect(()=>{if(!s.current)return;const i=()=>{s.current&&c(s.current.clientHeight)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const h=i=>{o(i.currentTarget.scrollTop)},p=t.length*u,d=Math.max(0,Math.floor(r/u)-v),f=Math.min(t.length,Math.ceil((r+a)/u)+v),b=t.slice(d,f);return t.length<100?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden",children:t.map(i=>e.jsx(g,{file:i,onNavigate:n},i.path))}):e.jsx("div",{ref:s,className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-auto",onScroll:h,style:{height:"600px"},children:e.jsx("div",{style:{height:p,position:"relative"},children:b.map((i,x)=>{const m=d+x;return e.jsx(C,{file:i,index:m,onNavigate:n},i.path)})})})}function R(){const t=F(j.repository.owner,j.repository.name),{startTimer:n,endTimer:s}=S("file-browser"),[r,o]=l.useState(""),[a,c]=l.useState([]),[h,p]=l.useState(!0),[d,f]=l.useState(null);l.useEffect(()=>{b(r)},[r]);const b=async x=>{try{p(!0),f(null),n("directory_load_ms");const m=await t.listDirectory(x),N=L(m);s("directory_load_ms"),c(N)}catch(m){f(m.message)}finally{p(!1)}},i=l.useCallback(x=>{o(x)},[]);return h&&a.length===0?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"bg-white border-b border-neutral-200 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"})}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading files..."})})]}):d?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"bg-white border-b border-neutral-200 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"})}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center text-red-600 py-8",children:["Error: ",d,e.jsx("br",{}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors",onClick:()=>b(r),children:"Retry"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"bg-white border-b border-neutral-200 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"})}),e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[e.jsx(E,{currentPath:r,onNavigate:i}),h?e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading..."}):a.length===0?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"This directory is empty"})}):e.jsx(T,{files:a,onNavigate:i})]})]})}export{R as default};
