import{r as a}from"./state-DOKsaQ-a.js";import{c as T,u as j}from"./main-DpeyGvqJ.js";function E(h,f){return function(c,o){const C=h.token,{getCache:b,setCache:y,invalidateCache:u}=f,m=`https://api.github.com/repos/${c}/${o}`,i=a.useCallback(t=>btoa(unescape(encodeURIComponent(t))),[]),l=a.useCallback(t=>decodeURIComponent(escape(atob(t))),[]),s=a.useCallback(async(t,n={})=>{const e=await fetch(`${m}/contents/${t}`,{...n,headers:{Authorization:`Bearer ${C}`,Accept:"application/vnd.github.v3+json",...n.headers}});if(!e.ok)throw e.status===401?(h.logout(),new Error("Authentication expired")):new Error(`Failed to ${n.method||"fetch"} ${t}: ${e.statusText}`);return e.json()},[m,C]),d=a.useCallback(async t=>{const n=b(c,o,t);if(n)return{content:n.content,sha:n.sha,path:t};const e=await s(t),r={content:l(e.content),sha:e.sha,path:e.path,name:e.name,size:e.size};return y(c,o,t,r.content,r.sha),r},[c,o,b,y,s,l]),g=a.useCallback(async(t,n,e,r)=>{const S=await s(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r||`Update ${t}`,content:i(n),sha:e})});return u(c,o,t),S},[c,o,s,i,u]),k=a.useCallback(async(t,n,e)=>s(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e||`Create ${t}`,content:i(n)})}),[s,i]),p=a.useCallback(async(t,n,e)=>{const r=await s(t,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e||`Delete ${t}`,sha:n})});return u(c,o,t),r},[c,o,s,u]),$=a.useCallback(async(t="")=>s(t),[s]),A=a.useCallback(async t=>{try{const n=await d(`${t}/manifest.json`);return JSON.parse(n.content)}catch{return null}},[d]);return{getFile:d,updateFile:g,createFile:k,deleteFile:p,listDirectory:$,getManifest:A,encodeContent:i,decodeContent:l}}}const P=E(j.getState(),T.getState());export{P as u};
