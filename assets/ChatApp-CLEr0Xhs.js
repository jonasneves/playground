import{r as a,j as e,f as E,T as M}from"./react-vendor-axii0Xj-.js";import{u as j}from"./useLocalStorage-BMbOBrEE.js";import{u as I}from"./usePerformanceMonitor-B_jUtpwc.js";import{u as T,a as R}from"./index-sruhKteV.js";import"./vendor-7OC5HNn7.js";import"./state-CWLQzQDb.js";const k=a.memo(({message:t,style:r})=>t.role==="user"?e.jsx("div",{style:r,className:"flex justify-end","data-role":t.role,children:e.jsx("div",{className:"px-5 py-3 rounded-2xl rounded-br-sm bg-brand-600 text-white text-[15px] leading-relaxed max-w-[85%] shadow-sm",children:t.content})}):t.role==="assistant"?e.jsxs("div",{style:r,className:"flex gap-3","data-role":t.role,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-600/10 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",className:"text-brand-600",children:e.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})}),e.jsx("div",{className:"px-5 py-3 rounded-2xl rounded-tl-sm bg-white border border-neutral-200 text-neutral-700 text-[15px] leading-relaxed max-w-[85%] shadow-sm",children:t.content})]}):e.jsx("div",{style:r,className:"flex justify-center","data-role":t.role,children:e.jsx("div",{className:"px-4 py-2 rounded-lg bg-amber-50 border border-amber-200 text-amber-800 text-sm text-center max-w-[85%]",children:t.content})}));k.displayName="MessageBubble";const w=50,N=100;function _({messages:t}){const r=a.useRef(null),o=a.useRef(!0),l=a.useMemo(()=>t.length<=w?t:t.slice(-N),[t]);a.useEffect(()=>{o.current&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[t]);const n=()=>{if(!r.current)return;const{scrollTop:u,scrollHeight:d,clientHeight:s}=r.current,c=Math.abs(d-s-u)<50;o.current=c};return e.jsx("div",{ref:r,className:"flex-1 overflow-y-auto px-6 py-6",id:"chat",onScroll:n,children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-8",children:[e.jsx("div",{className:"w-20 h-20 bg-brand-600/10 rounded-3xl flex items-center justify-center mb-6",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-brand-600",children:e.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})}),e.jsx("h2",{className:"text-xl font-bold text-neutral-900 mb-2",children:"AI Chat"}),e.jsx("p",{className:"text-sm text-neutral-500 max-w-sm",children:"Start a conversation with AI"})]}):e.jsxs("div",{className:"space-y-4",children:[t.length>w&&e.jsxs("div",{className:"text-center text-xs text-neutral-400 py-2",children:["Showing last ",N," of ",t.length," messages"]}),l.map((u,d)=>e.jsx(k,{message:u},u.id||d))]})})}function L({onSend:t,disabled:r}){const[o,l]=a.useState(""),n=a.useRef(null);a.useEffect(()=>{r||n.current?.focus()},[r]),a.useEffect(()=>{const s=c=>{if(document.activeElement===n.current||r||c.ctrlKey||c.metaKey||c.altKey||c.key.length>1&&c.key!=="Space")return;const f=c.target;f.tagName==="INPUT"||f.tagName==="TEXTAREA"||n.current?.focus()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[r]);const u=()=>{const s=o.trim();!s||r||(t(s),l(""),n.current?.focus())},d=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),u())};return e.jsx("div",{className:"px-6 py-5 bg-white border-t border-neutral-200",children:e.jsxs("div",{className:"flex items-center gap-2 pl-5 pr-2 py-2 bg-neutral-50 border border-neutral-200 rounded-[28px] transition-all duration-100 focus-within:border-brand-600 focus-within:shadow-[0_0_0_3px_rgba(44,79,124,0.1)]",children:[e.jsx("input",{ref:n,type:"text",id:"input",value:o,onChange:s=>l(s.target.value),onKeyDown:d,placeholder:"Type a message...",disabled:r,className:"flex-1 py-2 px-0 bg-transparent border-none text-[15px] text-neutral-900 placeholder-neutral-400 focus:outline-none disabled:text-neutral-400"}),e.jsx("button",{onClick:u,disabled:r||!o.trim(),id:"send-btn",className:"w-10 h-10 p-0 flex items-center justify-center bg-brand-600 hover:bg-brand-700 text-white rounded-full transition-all duration-100 disabled:bg-neutral-300 disabled:text-neutral-500 disabled:cursor-not-allowed flex-shrink-0","aria-label":"Send message",children:e.jsx(E,{size:18})})]})})}function D(t,r={}){const{maxBatchSize:o=1/0}=r,l=a.useRef([]),n=a.useRef(void 0),u=a.useCallback(s=>{const c=Array.isArray(s)?s:[s];if(l.current.push(...c),l.current.length>=o){n.current!==void 0&&(cancelAnimationFrame(n.current),n.current=void 0),t(l.current),l.current=[];return}n.current||(n.current=requestAnimationFrame(()=>{t(l.current),l.current=[],n.current=void 0}))},[t,o]),d=a.useCallback(()=>{n.current!==void 0&&(cancelAnimationFrame(n.current),n.current=void 0),l.current.length>0&&(t(l.current),l.current=[])},[t]);return a.useEffect(()=>()=>{n.current!==void 0&&cancelAnimationFrame(n.current)},[]),{accumulate:u,flush:d}}const B=[{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"meta-llama-3.1-70b-instruct",label:"Llama 3.1 70B"},{value:"mistral-large",label:"Mistral Large"}];function U(){const t=T(i=>i.token),{startTimer:r,endTimer:o}=I("chat"),[l,n,u]=j("chat_history",[]),[d,s]=j("chat_model","gpt-4o-mini"),[c,f]=a.useState(!1),{setCustomItems:b,clearCustomItems:g}=R();a.useEffect(()=>{o("ttfr")},[o]);const p=a.useCallback(()=>{confirm("Clear all chat history?")&&u()},[u]);a.useEffect(()=>(b([{id:"model-selector",label:"Model",onClick:()=>{},component:e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{htmlFor:"chat-model",className:"block text-xs font-medium text-neutral-500 mb-2",children:"AI Model"}),e.jsx("select",{id:"chat-model",value:d,onChange:i=>s(i.target.value),className:"w-full px-3 py-2 text-sm bg-white border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500",children:B.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]})},{id:"clear-chat",label:"Clear Chat",icon:M,onClick:p,variant:"danger"}]),()=>g()),[d,s,p,b,g]);const C=a.useCallback(i=>{n(h=>[...h,...i])},[n]),{accumulate:v}=D(C),x=a.useCallback((i,h)=>{const y={role:i,content:h,id:`${Date.now()}-${Math.random()}`};v(y)},[v]),A=a.useCallback(async i=>{if(!(!t||c)){f(!0),x("user",i);try{r("api_latency_ms");const h=await fetch("https://models.inference.ai.azure.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:d,messages:[...l,{role:"user",content:i}].slice(-20).map(m=>({role:m.role,content:m.content})),temperature:.7,max_tokens:1e3})});if(!h.ok){const m=await h.json().catch(()=>({error:{message:`API error: ${h.status}`}}));throw new Error(m.error?.message||`API error: ${h.status}`)}const S=(await h.json()).choices[0].message.content;o("api_latency_ms"),x("assistant",S)}catch(h){x("system",`Error: ${h.message}`)}finally{f(!1)}}},[t,d,l,c,x,r,o]);return e.jsxs("div",{className:"h-screen flex flex-col bg-neutral-100",children:[e.jsx("div",{className:"bg-brand-500 px-6 py-3.5",children:e.jsx("button",{onClick:p,className:"text-lg font-bold text-white hover:text-white/90 transition-colors duration-100",title:"Click to clear chat",children:"AI Chat"})}),e.jsx("div",{className:"flex-1 flex justify-center p-6 overflow-hidden",children:e.jsxs("div",{className:"w-full max-w-[800px] bg-white rounded-3xl shadow-2xl flex flex-col overflow-hidden",children:[e.jsx(_,{messages:l}),e.jsx(L,{onSend:A,disabled:c})]})})]})}export{U as default};
