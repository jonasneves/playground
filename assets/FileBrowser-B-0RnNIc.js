import{j as e,A as N}from"./main-DEWPCtcH.js";import{r as l}from"./state-DOKsaQ-a.js";import{F as w,a as k}from"./ui-BzbG-TcE.js";import{u as b}from"./index-Ctw9DyCw.js";import{u as B}from"./usePerformanceMonitor-DwVY0XIA.js";import"./vendor-CZvkgD4c.js";function C({currentPath:s,onNavigate:a}){const r=[{name:"root",path:""}];if(s){const t=s.split("/").filter(Boolean);let o="";for(const i of t)o=o?`${o}/${i}`:i,r.push({name:i,path:o})}return e.jsx("div",{className:"breadcrumb",children:r.map((t,o)=>e.jsxs("span",{children:[o>0&&e.jsx("span",{className:"separator",children:" / "}),e.jsx("a",{href:"#",onClick:i=>{i.preventDefault(),a(t.path)},children:t.name})]},t.path))})}function S(s){return s?s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`:""}function E(s){return[...s].sort((a,r)=>a.type===r.type?a.name.localeCompare(r.name):a.type==="dir"?-1:1)}const v=l.memo(({file:s,onNavigate:a,style:r})=>{const t=s.type==="dir",o=t?e.jsx(w,{size:20}):e.jsx(k,{size:20}),i=t?"":S(s.size),c=()=>{t&&a(s.path)};return e.jsxs("div",{className:`file-item ${t?"clickable":""}`,onClick:c,style:r,children:[e.jsx("span",{className:"icon",children:o}),e.jsx("span",{className:"file-name",children:s.name}),e.jsx("span",{className:"file-size",children:i})]})});v.displayName="FileListItem";const u=56,y=5;function T({files:s,onNavigate:a}){const r=l.useRef(null),[t,o]=l.useState(0),[i,c]=l.useState(600);l.useEffect(()=>{if(!r.current)return;const n=()=>{r.current&&c(r.current.clientHeight)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const p=n=>{o(n.currentTarget.scrollTop)},x=s.length*u,d=Math.max(0,Math.floor(t/u)-y),f=Math.min(s.length,Math.ceil((t+i)/u)+y),j=s.slice(d,f);return s.length<100?e.jsx("div",{className:"file-list",children:s.map(n=>e.jsx(v,{file:n,onNavigate:a},n.path))}):e.jsx("div",{ref:r,className:"file-list virtual-scroll",onScroll:p,style:{height:"600px",overflow:"auto"},children:e.jsx("div",{style:{height:x,position:"relative"},children:j.map((n,h)=>{const m=d+h;return e.jsx(v,{file:n,onNavigate:a,style:{position:"absolute",top:m*u,left:0,right:0,height:u}},n.path)})})})}function G(){const s=b(N.repository.owner,N.repository.name),{startTimer:a,endTimer:r}=B("file-browser"),[t,o]=l.useState(""),[i,c]=l.useState([]),[p,x]=l.useState(!0),[d,f]=l.useState(null);l.useEffect(()=>{j(t)},[t]);const j=async m=>{try{x(!0),f(null),a("directory_load_ms");const g=await s.listDirectory(m),F=E(g);r("directory_load_ms"),c(F)}catch(g){f(g.message)}finally{x(!1)}},n=l.useCallback(m=>{o(m)},[]),h=()=>{window.parent.postMessage("close-app","*")};return p&&i.length===0?e.jsxs("div",{children:[e.jsxs("div",{className:"header",children:[e.jsx("h2",{children:"üìÅ File Browser"}),e.jsx("button",{className:"btn",onClick:h,children:"‚Üê Back to Gallery"})]}),e.jsx("div",{className:"container",children:e.jsx("div",{className:"loading",children:"Loading files..."})})]}):d?e.jsxs("div",{children:[e.jsxs("div",{className:"header",children:[e.jsx("h2",{children:"üìÅ File Browser"}),e.jsx("button",{className:"btn",onClick:h,children:"‚Üê Back to Gallery"})]}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"loading",style:{color:"#ef4444"},children:["Error: ",d,e.jsx("br",{}),e.jsx("button",{className:"btn",onClick:()=>j(t),style:{marginTop:"16px",background:"#667eea",color:"white"},children:"Retry"})]})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"header",children:[e.jsx("h2",{children:"üìÅ File Browser"}),e.jsx("button",{className:"btn",onClick:h,children:"‚Üê Back to Gallery"})]}),e.jsxs("div",{className:"container",children:[e.jsx(C,{currentPath:t,onNavigate:n}),p?e.jsx("div",{className:"loading",children:"Loading..."}):i.length===0?e.jsx("div",{className:"file-list",children:e.jsx("div",{className:"empty-state",children:"This directory is empty"})}):e.jsx(T,{files:i,onNavigate:n})]})]})}export{G as default};
