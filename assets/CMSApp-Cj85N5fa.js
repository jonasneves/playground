import{r as t,j as e,F as I,k as L,u as T,l as P,X as O}from"./react-vendor-CaUiYEua.js";import{u as $}from"./index-jNRGfjAH.js";import{u as _}from"./usePerformanceMonitor-DTPsaa79.js";import{b as z,A as M}from"./index-C2hdIUZW.js";import"./vendor-GYNWQ9K3.js";import"./state-DiVqNZBa.js";const j=t.memo(function({item:n,level:a,isOpen:s,isSelected:l,onToggle:d,onSelect:x}){return n.type==="dir"?e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 hover:bg-neutral-100 cursor-pointer text-sm text-neutral-700 transition-colors",style:{paddingLeft:`${a*16+16}px`},onClick:d,children:[e.jsx(I,{size:16,className:s?"text-brand-600":""}),e.jsx("span",{className:"font-medium",children:n.name})]}):e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1.5 hover:bg-neutral-100 cursor-pointer text-sm transition-colors ${l?"bg-brand-50 text-brand-700":"text-neutral-600"}`,style:{paddingLeft:`${a*16+16}px`},onClick:x,children:[e.jsx(L,{size:16}),e.jsx("span",{children:n.name})]})});function W({files:i,onFileSelect:n,selectedFile:a,onLoadDirectory:s}){const[l,d]=t.useState({}),x=t.useCallback(async r=>{d(m=>{const o=m[r.path]||{isOpen:!1,children:[],isLoaded:!1};return o.isOpen?{...m,[r.path]:{...o,isOpen:!1}}:o.isLoaded?{...m,[r.path]:{...o,isOpen:!0}}:(s(r.path).then(f=>{d(u=>({...u,[r.path]:{isOpen:!0,children:f,isLoaded:!0}}))}),m)})},[s]),p=t.useCallback((r,m=0)=>{const o=r.type==="dir",f=l[r.path],u=f?.isOpen||!1,b=a?.path===r.path;return o?e.jsxs("div",{children:[e.jsx(j,{item:r,level:m,isOpen:u,isSelected:!1,onToggle:()=>x(r)}),u&&f?.children?.length>0&&e.jsx("div",{children:f.children.map(g=>p(g,m+1))})]},r.path):e.jsx(j,{item:r,level:m,isOpen:!1,isSelected:b,onSelect:()=>n(r)},r.path)},[l,a,x,n]);return e.jsx("div",{children:i.map(r=>p(r))})}function A({content:i,onChange:n,disabled:a,placeholder:s}){const l=t.useRef(null);return t.useEffect(()=>{i&&l.current&&l.current.focus()},[i]),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Editor"}),e.jsx("textarea",{ref:l,id:"editor",value:i,onChange:d=>n(d.target.value),disabled:a,placeholder:s||"Select a file to edit...",className:"flex-1 w-full px-6 py-4 font-mono text-sm text-neutral-900 resize-none focus:outline-none disabled:bg-neutral-50 disabled:text-neutral-400"})]})}function q(){const[i,n]=t.useState(""),[a,s]=t.useState(!1),[l,d]=t.useState(null),x=t.useRef(null),p=t.useRef(0),r=t.useRef(null);t.useEffect(()=>{const o=new Worker(new URL("/assets/markdown.worker-Dti5hhgv.js",import.meta.url),{type:"module"});return o.onmessage=f=>{const{id:u,html:b,error:g}=f.data;if(u==="ready"){s(!0);return}r.current===u&&(g?d(g):(n(b),d(null)),r.current=null)},o.onerror=f=>{console.error("Markdown worker error:",f),d("Worker error occurred"),s(!1)},x.current=o,()=>{o.terminate()}},[]);const m=t.useCallback(o=>{if(!x.current||!a)return;const f=`request-${++p.current}`;r.current=f;const u={id:f,markdown:o};x.current.postMessage(u)},[a]);return{html:i,parse:m,isReady:a,error:l}}function H(i,n){const[a,s]=t.useState(i);return t.useEffect(()=>{const l=setTimeout(()=>{s(i)},n);return()=>{clearTimeout(l)}},[i,n]),a}function U({content:i,isMarkdown:n}){const{html:a,parse:s,isReady:l,error:d}=q(),x=H(i,300);return t.useEffect(()=>{n&&l&&x&&s(x)},[x,n,l,s]),n?d?e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"text-center text-red-600 py-8",children:["Error: ",d]})})]}):i?e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:a}})]}):e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"Preview will appear here for markdown files"})})]}):e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"Preview available for markdown files only"})})]})}function K(){const i=T(),{repository:n}=z(),a=n||M.repository,s=$(a.owner,a.name),{startTimer:l,endTimer:d}=_("cms"),[x,p]=t.useState([]),[r,m]=t.useState(null),[o,f]=t.useState(""),[u,b]=t.useState(!1),[g,v]=t.useState(!1),[N,w]=t.useState(!0),y=t.useCallback(c=>c.filter(h=>!h.name.startsWith(".")&&h.name!=="node_modules"),[]);t.useEffect(()=>{S()},[]);const S=async()=>{try{w(!0);const c=await s.listDirectory("");p(y(c))}catch(c){console.error("Error loading directory:",c),alert(`Error: ${c.message}`)}finally{w(!1)}},C=t.useCallback(async c=>{try{const h=await s.listDirectory(c);return y(h)}catch(h){return console.error("Error loading directory:",h),[]}},[s,y]),k=t.useCallback(async c=>{if(c.type!=="dir"&&!(u&&!confirm("You have unsaved changes. Discard them?")))try{const h=await s.getFile(c.path);m(h),f(h.content),b(!1)}catch(h){alert(`Error loading file: ${h.message}`)}},[s,u]),R=t.useCallback(c=>{f(c),b(!0)},[]),D=t.useCallback(async()=>{if(!(!r||!u)){v(!0);try{l("save_latency_ms");const c=`Update ${r.path.split("/").pop()}`;await s.updateFile(r.path,o,r.sha,c);const h=await s.getFile(r.path);d("save_latency_ms"),m(h),b(!1),alert("Saved successfully!")}catch(c){alert(`Error saving: ${c.message}`)}finally{v(!1)}}},[r,o,u,s,l,d]),E=()=>{u&&!confirm("You have unsaved changes. Close anyway?")||i("/")},F=r?.path.endsWith(".md")||!1;return e.jsxs("div",{className:"flex flex-col h-screen bg-neutral-50",children:[e.jsx("div",{className:"bg-white border-b border-neutral-200 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"Content Manager"})}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-64 bg-white border-r border-neutral-200 overflow-y-auto",children:[e.jsx("div",{className:"px-4 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Repository Files"}),N?e.jsx("div",{className:"p-5 text-center text-neutral-400",children:"Loading..."}):e.jsx(W,{files:x,onFileSelect:k,selectedFile:r?{...r,type:"file"}:null,onLoadDirectory:C})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(A,{content:o,onChange:R,disabled:!r}),e.jsx(U,{content:o,isMarkdown:F})]})]}),e.jsxs("div",{className:"fixed bottom-6 right-6 flex items-center gap-2 z-40",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors shadow-lg disabled:bg-neutral-300 disabled:cursor-not-allowed",onClick:D,disabled:!u||g,children:[e.jsx(P,{size:16}),g?"Saving...":"Save"]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors shadow-lg",onClick:E,children:[e.jsx(O,{size:16}),"Close"]})]})]})}export{K as default};
