import{j as e,a as F,A as y}from"./main-CNCu5yuJ.js";import{r as l}from"./state-DOKsaQ-a.js";import{F as k,a as B}from"./ui-D_bnl3Nn.js";import{u as C}from"./index-C2qejedY.js";import{u as S}from"./usePerformanceMonitor-CQRhZHFI.js";import"./vendor-CZvkgD4c.js";function E({currentPath:t,onNavigate:o}){const n=[{name:"root",path:""}];if(t){const r=t.split("/").filter(Boolean);let s="";for(const i of r)s=s?`${s}/${i}`:i,n.push({name:i,path:s})}return e.jsx("div",{className:"flex items-center gap-2 px-4 py-3 mb-4 bg-white rounded-lg border border-neutral-200 text-sm",children:n.map((r,s)=>e.jsxs("span",{className:"flex items-center gap-2",children:[s>0&&e.jsx("span",{className:"text-neutral-400",children:"/"}),e.jsx("a",{href:"#",onClick:i=>{i.preventDefault(),o(r.path)},className:"text-brand-600 hover:text-brand-700 hover:underline transition-colors",children:r.name})]},r.path))})}function T(t){return t?t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`:""}function I(t){return[...t].sort((o,n)=>o.type===n.type?o.name.localeCompare(n.name):o.type==="dir"?-1:1)}const v=l.memo(({file:t,onNavigate:o,style:n})=>{const r=t.type==="dir",s=r?e.jsx(k,{size:20}):e.jsx(B,{size:20}),i=r?"":T(t.size),c=()=>{r&&o(t.path)};return e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 border-b border-neutral-100 last:border-b-0 ${r?"cursor-pointer hover:bg-neutral-50 transition-colors":""}`,onClick:c,style:n,children:[e.jsx("span",{className:`flex-shrink-0 ${r?"text-brand-600":"text-neutral-400"}`,children:s}),e.jsx("span",{className:"flex-1 text-sm text-neutral-900 truncate",children:t.name}),i&&e.jsx("span",{className:"flex-shrink-0 text-xs text-neutral-500",children:i})]})});v.displayName="FileListItem";const u=56,N=5;function L({files:t,onNavigate:o}){const n=l.useRef(null),[r,s]=l.useState(0),[i,c]=l.useState(600);l.useEffect(()=>{if(!n.current)return;const a=()=>{n.current&&c(n.current.clientHeight)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const f=a=>{s(a.currentTarget.scrollTop)},m=t.length*u,d=Math.max(0,Math.floor(r/u)-N),h=Math.min(t.length,Math.ceil((r+i)/u)+N),p=t.slice(d,h);return t.length<100?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden",children:t.map(a=>e.jsx(v,{file:a,onNavigate:o},a.path))}):e.jsx("div",{ref:n,className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-auto",onScroll:f,style:{height:"600px"},children:e.jsx("div",{style:{height:m,position:"relative"},children:p.map((a,b)=>{const x=d+b;return e.jsx(v,{file:a,onNavigate:o,style:{position:"absolute",top:x*u,left:0,right:0,height:u}},a.path)})})})}function _(){const t=F(),o=C(y.repository.owner,y.repository.name),{startTimer:n,endTimer:r}=S("file-browser"),[s,i]=l.useState(""),[c,f]=l.useState([]),[m,d]=l.useState(!0),[h,p]=l.useState(null);l.useEffect(()=>{a(s)},[s]);const a=async g=>{try{d(!0),p(null),n("directory_load_ms");const j=await o.listDirectory(g),w=I(j);r("directory_load_ms"),f(w)}catch(j){p(j.message)}finally{d(!1)}},b=l.useCallback(g=>{i(g)},[]),x=()=>{t("/")};return m&&c.length===0?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"}),e.jsx("button",{className:"px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:x,children:"← Back to Gallery"})]}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading files..."})})]}):h?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"}),e.jsx("button",{className:"px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:x,children:"← Back to Gallery"})]}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center text-red-600 py-8",children:["Error: ",h,e.jsx("br",{}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors",onClick:()=>a(s),children:"Retry"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"}),e.jsx("button",{className:"px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:x,children:"← Back to Gallery"})]}),e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[e.jsx(E,{currentPath:s,onNavigate:b}),m?e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading..."}):c.length===0?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"This directory is empty"})}):e.jsx(L,{files:c,onNavigate:b})]})]})}export{_ as default};
