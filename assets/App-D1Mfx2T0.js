import{r as d,j as e,u as C,h as E,f as G,T as H,i as T,k as O,l as _,m as A}from"./react-vendor-Cs3UoJXk.js";import{u as $,b as D,a as I,A as g}from"./main-BKxJeJkg.js";import{u as U}from"./index-DXJFSLEw.js";import"./vendor-7OC5HNn7.js";import"./state-CWLQzQDb.js";function q({children:s,oauthServiceUrl:t,onAuthChange:o,isAuthenticated:i}){const[n,a]=d.useState(!0),[l,u]=d.useState(!1);return d.useEffect(()=>{const r=document.createElement("script");return r.src=`${t}/github-auth.js?v=${Date.now()}`,r.async=!0,r.onload=()=>{setTimeout(()=>{window.GitHubAuth?u(!0):(console.error("GitHubAuth not available after script load"),a(!1))},100)},r.onerror=()=>{console.error("Failed to load OAuth script"),a(!1)},document.head.appendChild(r),()=>{document.head.contains(r)&&document.head.removeChild(r)}},[t]),d.useEffect(()=>{if(l)if(window.GitHubAuth.isAuthenticated()){const r=window.GitHubAuth.getUser(),c=window.GitHubAuth.getToken();r&&c&&setTimeout(()=>{o(c,r),a(!1)},0)}else window.GitHubAuth.init({scope:"repo",onLogin:r=>{const c=window.GitHubAuth.getUser();c&&setTimeout(()=>{o(r,c),a(!1)},0)}}),a(!1)},[l,o]),n?e.jsx("div",{className:"loading",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{border:"4px solid rgba(255,255,255,0.3)",borderRadius:"50%",borderTopColor:"white",width:"50px",height:"50px",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),e.jsx("p",{children:"Initializing..."})]})}):i?e.jsx(e.Fragment,{children:s}):e.jsx("div",{className:"loading",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{children:"Authentication Required"}),e.jsx("p",{style:{marginTop:16,marginBottom:24,opacity:.9},children:"Please sign in with GitHub to access the gallery"}),e.jsx("button",{onClick:()=>window.GitHubAuth.login(),style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:"pointer"},children:"Sign in with GitHub"})]})})}function v({user:s,onLogout:t,onClearCache:o}){const[i,n]=d.useState(!1),a=d.useRef(null),l=C();d.useEffect(()=>{function c(h){a.current&&!a.current.contains(h.target)&&n(!1)}return document.addEventListener("click",c),()=>document.removeEventListener("click",c)},[]);const u=()=>{confirm("Clear all cached data? Apps will reload from the repository.")&&(o(),window.location.reload())},r=()=>{n(!1),l("/settings")};return s?e.jsxs("div",{ref:a,className:"fixed top-6 right-6 z-50",children:[e.jsxs("button",{onClick:()=>n(!i),className:"flex items-center gap-3 bg-white/80 backdrop-blur-md border border-neutral-200 rounded-full px-4 py-2 hover:bg-white transition-all duration-200 shadow-sm",children:[e.jsx("img",{src:s.avatar_url,alt:s.login,loading:"lazy",className:"w-8 h-8 rounded-full ring-2 ring-white"}),e.jsx("span",{className:"text-sm font-medium text-neutral-900",children:s.name||s.login})]}),e.jsxs("div",{className:`absolute top-14 right-0 bg-white border border-neutral-200 rounded-2xl shadow-xl min-w-[200px] overflow-hidden transition-all duration-200 ${i?"opacity-100 visible translate-y-0":"opacity-0 invisible -translate-y-2"}`,children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 transition-colors",children:[e.jsx(E,{size:16})," Refresh"]}),e.jsxs("button",{onClick:r,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 transition-colors border-t border-neutral-100",children:[e.jsx(G,{size:16})," Settings"]}),e.jsxs("button",{onClick:u,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 transition-colors border-t border-neutral-100",children:[e.jsx(H,{size:16})," Clear Cache"]}),e.jsxs("button",{onClick:t,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors border-t border-neutral-100",children:[e.jsx(T,{size:16})," Logout"]})]})]}):null}function P(s,t){if(!s?.minLauncherVersion||!t)return null;const o=t.split(".").map(Number),i=s.minLauncherVersion.split(".").map(Number);for(let n=0;n<3;n++){if(o[n]<i[n])return`Requires launcher v${s.minLauncherVersion}`;if(o[n]>i[n])return null}return null}function V({appName:s,manifest:t,path:o,onLaunch:i,version:n}){if(!t)return e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-900 mb-2",children:s}),e.jsx("p",{className:"text-neutral-400",children:"Loading..."})]})});const a=P(t,n);return e.jsxs("div",{className:"bg-white rounded-xl border border-neutral-200 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200 overflow-hidden group flex flex-col h-full",children:[e.jsx("div",{className:`w-full bg-gradient-to-br from-brand-50 to-neutral-50 flex items-center justify-center ${t.thumbnail?"h-32":"h-20"}`,children:t.thumbnail?e.jsx("img",{src:t.thumbnail,alt:t.name,loading:"lazy",className:"w-full h-full object-cover",onError:l=>{l.currentTarget.style.display="none"}}):e.jsx("div",{className:"text-4xl text-neutral-400",children:t.name.charAt(0)})}),e.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-neutral-900 mb-1",children:t.name}),e.jsx("p",{className:"text-neutral-600 text-xs leading-relaxed mb-3 line-clamp-2",children:t.description}),a&&e.jsxs("div",{className:"flex items-center gap-1.5 text-amber-600 text-xs mb-3 bg-amber-50 px-2 py-1.5 rounded",children:[e.jsx(O,{size:12}),e.jsx("span",{className:"text-[10px]",children:a})]}),t.tech&&t.tech.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mb-3",children:t.tech.map(l=>e.jsx("span",{className:"bg-neutral-100 text-neutral-700 px-2 py-0.5 rounded-full text-[10px] font-medium",children:l},l))}),e.jsxs("button",{onClick:()=>i(o,t.name),className:"inline-flex items-center justify-center gap-1.5 bg-gradient-to-r from-brand-600 to-brand-700 hover:from-brand-700 hover:to-brand-800 text-white px-3 py-2 rounded-lg font-medium text-xs transition-all duration-200 group-hover:gap-2 mt-auto",children:["Launch App",e.jsx(_,{size:14,className:"transition-transform duration-200"})]})]})]})}function F({config:s,user:t,useGitHubAPI:o,onLogout:i,onClearCache:n,onTrack:a,onNavigate:l}){const[u,r]=d.useState([]),[c,h]=d.useState(!0),[w,k]=d.useState(null),N=o(s.repository.owner,s.repository.name);d.useEffect(()=>{L()},[]);const L=async()=>{try{h(!0);const f=(await N.listDirectory("apps")).filter(m=>m.type==="dir"),b=f.map(m=>({name:m.name,path:m.path,manifest:null}));r(b);const j=f.map(async m=>{const p=await N.getManifest(m.path);return{name:m.name,manifest:p}}),z=await Promise.all(j);r(m=>m.map(p=>{const y=z.find(R=>R.name===p.name);return y?.manifest?{...p,manifest:y.manifest}:p})),h(!1)}catch(x){k(x.message),h(!1)}},S=d.useCallback((x,f)=>{a?.("app_launch",{appName:f,appPath:x});const b=u.find(j=>j.path===x)?.manifest;b?.reactRoute&&l&&l(b.reactRoute)},[u,a,l]);return c&&u.length===0?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed top-[70%] left-[75%] -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] sm:w-[600px] sm:h-[600px] rounded-full bg-brand-500 blur-[100px] sm:blur-[150px] opacity-40 animate-breathe pointer-events-none"}),e.jsx(v,{user:t,onLogout:i,onClearCache:n}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("header",{className:"py-16 sm:py-24 text-center",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-semibold text-neutral-900 flex items-center justify-center gap-3 mb-3",children:[e.jsx(A,{className:"text-brand-600",size:40}),s.branding.title]}),e.jsx("p",{className:"text-lg text-neutral-600 max-w-2xl mx-auto px-4",children:s.branding.subtitle})]}),e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-neutral-200 border-t-brand-600 rounded-full animate-[spin_1s_linear_infinite]"}),e.jsx("p",{className:"text-neutral-600",children:"Loading applications..."})]})})]})]}):w?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx(v,{user:t,onLogout:i,onClearCache:n}),e.jsx("div",{className:"container py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-xl p-6",children:[e.jsx("strong",{className:"font-semibold",children:"Error:"})," ",w]})})]}):e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed top-[70%] left-[75%] -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] sm:w-[600px] sm:h-[600px] rounded-full bg-brand-500 blur-[100px] sm:blur-[150px] opacity-40 animate-breathe pointer-events-none"}),e.jsx(v,{user:t,onLogout:i,onClearCache:n}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("header",{className:"py-16 sm:py-24 text-center",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-semibold text-neutral-900 flex items-center justify-center gap-3 mb-3",children:[e.jsx(A,{className:"text-brand-600",size:40}),s.branding.title]}),e.jsx("p",{className:"text-lg text-neutral-600 max-w-2xl mx-auto px-4",children:s.branding.subtitle})]}),e.jsx("div",{className:"container pb-20",children:e.jsx("div",{className:"grid",children:u.map(x=>e.jsx(V,{appName:x.name,manifest:x.manifest,path:x.path,onLaunch:S},x.name))})})]})]})}function Q(){const s=C(),{user:t,token:o,isAuthenticated:i,setAuth:n,logout:a}=$(),{clearCache:l}=D(),{track:u}=I();return e.jsx(q,{oauthServiceUrl:g.oauth.serviceUrl,onAuthChange:(r,c)=>{r&&c&&n(r,c)},isAuthenticated:i,children:e.jsx(F,{config:g,user:t,token:o,useGitHubAPI:U,onLogout:a,onClearCache:()=>l(g.repository.owner,g.repository.name),onTrack:u,onNavigate:r=>s(r)})})}export{Q as default};
