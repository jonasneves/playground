import{j as e,a as F,A as w}from"./main-69QiOEEr.js";import{r as t}from"./state-DOKsaQ-a.js";import{F as D,a as L,S as P,X as I}from"./ui-BKD9s6Oq.js";import{u as $}from"./index-CN0gSnF3.js";import{u as O}from"./usePerformanceMonitor-C2kepefC.js";import"./vendor-CZvkgD4c.js";function T({files:o,onFileSelect:s,selectedFile:d,onLoadDirectory:u}){const[c,f]=t.useState({}),a=async r=>{const x=c[r.path]||{isOpen:!1,children:[],isLoaded:!1};if(x.isOpen){f(n=>({...n,[r.path]:{...x,isOpen:!1}}));return}if(x.isLoaded)f(n=>({...n,[r.path]:{...x,isOpen:!0}}));else{const n=await u(r.path);f(i=>({...i,[r.path]:{isOpen:!0,children:n,isLoaded:!0}}))}},h=(r,x=0)=>{const n=r.type==="dir",i=c[r.path],p=i?.isOpen||!1,b=d?.path===r.path;return n?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 hover:bg-neutral-100 cursor-pointer text-sm text-neutral-700 transition-colors",style:{paddingLeft:`${x*16+16}px`},onClick:()=>a(r),children:[e.jsx(D,{size:16,className:p?"text-brand-600":""}),e.jsx("span",{className:"font-medium",children:r.name})]}),p&&i.children.length>0&&e.jsx("div",{children:i.children.map(g=>h(g,x+1))})]},r.path):e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1.5 hover:bg-neutral-100 cursor-pointer text-sm transition-colors ${b?"bg-brand-50 text-brand-700":"text-neutral-600"}`,style:{paddingLeft:`${x*16+16}px`},onClick:()=>s(r),children:[e.jsx(L,{size:16}),e.jsx("span",{children:r.name})]},r.path)};return e.jsx("div",{children:o.map(r=>h(r))})}function _({content:o,onChange:s,disabled:d,placeholder:u}){const c=t.useRef(null);return t.useEffect(()=>{o&&c.current&&c.current.focus()},[o]),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Editor"}),e.jsx("textarea",{ref:c,id:"editor",value:o,onChange:f=>s(f.target.value),disabled:d,placeholder:u||"Select a file to edit...",className:"flex-1 w-full px-6 py-4 font-mono text-sm text-neutral-900 resize-none focus:outline-none disabled:bg-neutral-50 disabled:text-neutral-400"})]})}function M(){const[o,s]=t.useState(""),[d,u]=t.useState(!1),[c,f]=t.useState(null),a=t.useRef(null),h=t.useRef(0),r=t.useRef(null);t.useEffect(()=>{const n=new Worker(new URL(""+new URL("markdown.worker-Dti5hhgv.js",import.meta.url).href,import.meta.url),{type:"module"});return n.onmessage=i=>{const{id:p,html:b,error:g}=i.data;if(p==="ready"){u(!0);return}r.current===p&&(g?f(g):(s(b),f(null)),r.current=null)},n.onerror=i=>{console.error("Markdown worker error:",i),f("Worker error occurred"),u(!1)},a.current=n,()=>{n.terminate()}},[]);const x=t.useCallback(n=>{if(!a.current||!d)return;const i=`request-${++h.current}`;r.current=i;const p={id:i,markdown:n};a.current.postMessage(p)},[d]);return{html:o,parse:x,isReady:d,error:c}}function z(o,s){const[d,u]=t.useState(o);return t.useEffect(()=>{const c=setTimeout(()=>{u(o)},s);return()=>{clearTimeout(c)}},[o,s]),d}function W({content:o,isMarkdown:s}){const{html:d,parse:u,isReady:c,error:f}=M(),a=z(o,300);return t.useEffect(()=>{s&&c&&a&&u(a)},[a,s,c,u]),s?f?e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"text-center text-red-600 py-8",children:["Error: ",f]})})]}):o?e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:d}})]}):e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"Preview will appear here for markdown files"})})]}):e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"Preview available for markdown files only"})})]})}function G(){const o=F(),s=$(w.repository.owner,w.repository.name),{startTimer:d,endTimer:u}=O("cms"),[c,f]=t.useState([]),[a,h]=t.useState(null),[r,x]=t.useState(""),[n,i]=t.useState(!1),[p,b]=t.useState(!1),[g,v]=t.useState(!0),y=t.useCallback(l=>l.filter(m=>!m.name.startsWith(".")&&m.name!=="node_modules"),[]);t.useEffect(()=>{j()},[]);const j=async()=>{try{v(!0);const l=await s.listDirectory("");f(y(l))}catch(l){console.error("Error loading directory:",l),alert(`Error: ${l.message}`)}finally{v(!1)}},N=t.useCallback(async l=>{try{const m=await s.listDirectory(l);return y(m)}catch(m){return console.error("Error loading directory:",m),[]}},[s,y]),S=t.useCallback(async l=>{if(l.type!=="dir"&&!(n&&!confirm("You have unsaved changes. Discard them?")))try{const m=await s.getFile(l.path);h(m),x(m.content),i(!1)}catch(m){alert(`Error loading file: ${m.message}`)}},[s,n]),C=t.useCallback(l=>{x(l),i(!0)},[]),k=t.useCallback(async()=>{if(!(!a||!n)){b(!0);try{d("save_latency_ms");const l=`Update ${a.path.split("/").pop()}`;await s.updateFile(a.path,r,a.sha,l);const m=await s.getFile(a.path);u("save_latency_ms"),h(m),i(!1),alert("Saved successfully!")}catch(l){alert(`Error saving: ${l.message}`)}finally{b(!1)}}},[a,r,n,s,d,u]),R=()=>{n&&!confirm("You have unsaved changes. Close anyway?")||o("/")},E=a?.path.endsWith(".md")||!1;return e.jsxs("div",{className:"flex flex-col h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"Content Manager"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors disabled:bg-neutral-300 disabled:cursor-not-allowed",onClick:k,disabled:!n||p,children:[e.jsx(P,{size:16}),p?"Saving...":"Save"]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:R,children:[e.jsx(I,{size:16}),"Close"]})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-64 bg-white border-r border-neutral-200 overflow-y-auto",children:[e.jsx("div",{className:"px-4 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Repository Files"}),g?e.jsx("div",{className:"p-5 text-center text-neutral-400",children:"Loading..."}):e.jsx(T,{files:c,onFileSelect:S,selectedFile:a?{...a,type:"file"}:null,onLoadDirectory:N})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(_,{content:r,onChange:C,disabled:!a}),e.jsx(W,{content:r,isMarkdown:E})]})]})]})}export{G as default};
