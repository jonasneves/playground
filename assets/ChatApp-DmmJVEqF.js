import{r as s,j as e,B as R,i as P,T as z}from"./react-vendor-CaUiYEua.js";import{u as M}from"./useLocalStorage-C_Sg1gXz.js";import{u as H}from"./usePerformanceMonitor-qHkTY8XR.js";import{u as W,a as U}from"./index-DhD5e5kW.js";import"./vendor-GYNWQ9K3.js";import"./state-DiVqNZBa.js";const _=s.memo(({message:t,style:n})=>t.role==="user"?e.jsx("div",{style:n,className:"flex justify-end","data-role":t.role,children:e.jsx("div",{className:"px-5 py-3 rounded-2xl rounded-br-sm bg-brand-600 text-white text-[15px] leading-relaxed max-w-[85%] shadow-sm",children:t.content})}):t.role==="assistant"?e.jsxs("div",{style:n,className:"flex gap-3","data-role":t.role,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-600/10 flex items-center justify-center flex-shrink-0",children:e.jsx(R,{size:16,className:"text-brand-600",strokeWidth:2.5})}),e.jsx("div",{className:"px-5 py-3 rounded-2xl rounded-tl-sm bg-white border border-neutral-200 text-neutral-700 text-[15px] leading-relaxed max-w-[85%] shadow-sm",children:t.content})]}):e.jsx("div",{style:n,className:"flex justify-center","data-role":t.role,children:e.jsx("div",{className:"px-4 py-2 rounded-lg bg-amber-50 border border-amber-200 text-amber-800 text-sm text-center max-w-[85%]",children:t.content})}));_.displayName="MessageBubble";const I=50,T=100;function G({messages:t}){const n=s.useRef(null),i=s.useRef(!0),l=s.useMemo(()=>t.length<=I?t:t.slice(-T),[t]);s.useEffect(()=>{i.current&&n.current&&(n.current.scrollTop=n.current.scrollHeight)},[t]);const r=()=>{if(!n.current)return;const{scrollTop:u,scrollHeight:d,clientHeight:a}=n.current,o=Math.abs(d-a-u)<50;i.current=o};return e.jsx("div",{ref:n,className:"flex-1 overflow-y-auto px-6 py-6",id:"chat",onScroll:r,children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-8",children:[e.jsx("div",{className:"w-20 h-20 bg-brand-600/10 rounded-3xl flex items-center justify-center mb-6",children:e.jsx(R,{size:40,className:"text-brand-600",strokeWidth:2})}),e.jsx("h2",{className:"text-xl font-bold text-neutral-900 mb-2",children:"AI Chat"}),e.jsx("p",{className:"text-sm text-neutral-500 max-w-sm",children:"Start a conversation with AI"})]}):e.jsxs("div",{className:"space-y-4",children:[t.length>I&&e.jsxs("div",{className:"text-center text-xs text-neutral-400 py-2",children:["Showing last ",T," of ",t.length," messages"]}),l.map((u,d)=>e.jsx(_,{message:u},u.id||d))]})})}function F({onSend:t,disabled:n}){const[i,l]=s.useState(""),r=s.useRef(null);s.useEffect(()=>{n||r.current?.focus()},[n]),s.useEffect(()=>{const a=o=>{if(document.activeElement===r.current||n||o.ctrlKey||o.metaKey||o.altKey||o.key.length>1&&o.key!=="Space")return;const h=o.target;h.tagName==="INPUT"||h.tagName==="TEXTAREA"||r.current?.focus()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[n]);const u=()=>{const a=i.trim();!a||n||(t(a),l(""),r.current?.focus())},d=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),u())};return e.jsx("div",{className:"px-6 py-5 bg-white border-t border-neutral-200",children:e.jsxs("div",{className:"flex items-center gap-2 pl-5 pr-2 py-2 bg-neutral-50 border border-neutral-200 rounded-[28px] transition-all duration-100 focus-within:border-brand-600 focus-within:shadow-[0_0_0_3px_rgba(44,79,124,0.1)]",children:[e.jsx("input",{ref:r,type:"text",id:"input",value:i,onChange:a=>l(a.target.value),onKeyDown:d,placeholder:"Type a message...",disabled:n,className:"flex-1 py-2 px-0 bg-transparent border-none text-[15px] text-neutral-900 placeholder-neutral-400 focus:outline-none disabled:text-neutral-400"}),e.jsx("button",{onClick:u,disabled:n||!i.trim(),id:"send-btn",className:"w-10 h-10 p-0 flex items-center justify-center bg-brand-600 hover:bg-brand-700 text-white rounded-full transition-all duration-100 disabled:bg-neutral-300 disabled:text-neutral-500 disabled:cursor-not-allowed flex-shrink-0","aria-label":"Send message",children:e.jsx(P,{size:18})})]})})}function J(t,n={}){const{maxBatchSize:i=1/0}=n,l=s.useRef([]),r=s.useRef(void 0),u=s.useCallback(a=>{const o=Array.isArray(a)?a:[a];if(l.current.push(...o),l.current.length>=i){r.current!==void 0&&(cancelAnimationFrame(r.current),r.current=void 0),t(l.current),l.current=[];return}r.current||(r.current=requestAnimationFrame(()=>{t(l.current),l.current=[],r.current=void 0}))},[t,i]),d=s.useCallback(()=>{r.current!==void 0&&(cancelAnimationFrame(r.current),r.current=void 0),l.current.length>0&&(t(l.current),l.current=[])},[t]);return s.useEffect(()=>()=>{r.current!==void 0&&cancelAnimationFrame(r.current)},[]),{accumulate:u,flush:d}}const Z=[{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"meta-llama-3.1-70b-instruct",label:"Llama 3.1 70B"},{value:"mistral-large",label:"Mistral Large"}];function re(){const t=W(c=>c.token),{startTimer:n,endTimer:i}=H("chat"),[l,r,u]=M("chat_history",[]),[d,a]=M("chat_model","gpt-4o-mini"),[o,h]=s.useState(!1),{setCustomItems:j,clearCustomItems:N}=U(),k=s.useCallback(()=>{confirm("Clear all chat history?")&&u()},[u]);s.useEffect(()=>(j([{id:"model-selector",label:"Model",onClick:()=>{},component:e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("label",{htmlFor:"chat-model",className:"block text-xs font-medium text-neutral-500 mb-2",children:"AI Model"}),e.jsx("select",{id:"chat-model",value:d,onChange:c=>a(c.target.value),className:"w-full px-3 py-2 text-sm bg-white border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500",children:Z.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]})},{id:"clear-chat",label:"Clear Chat",icon:z,onClick:k,variant:"danger"}]),()=>N()),[d,a,k,j,N]);const D=s.useCallback(c=>{r(f=>[...f,...c])},[r]),{accumulate:C}=J(D),b=s.useCallback((c,f)=>{const g={role:c,content:f,id:`${Date.now()}-${Math.random()}`};C(g)},[C]),L=s.useCallback(async c=>{if(!t||o)return;h(!0),b("user",c);const f=`${Date.now()}-${Math.random()}`,g={role:"assistant",content:"",id:f};try{n("api_latency_ms");const x=await fetch("https://models.inference.ai.azure.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:d,messages:[...l,{role:"user",content:c}].slice(-20).map(m=>({role:m.role,content:m.content})),temperature:.7,max_tokens:1e3,stream:!0})});if(!x.ok){const m=await x.json().catch(()=>({error:{message:`API error: ${x.status}`}}));throw new Error(m.error?.message||`API error: ${x.status}`)}r(m=>[...m,g]);const p=x.body?.getReader(),v=new TextDecoder;let S="";if(!p)throw new Error("No response body");for(;;){const{done:m,value:B}=await p.read();if(m)break;const O=v.decode(B,{stream:!0}).split(`
`).filter(y=>y.trim().startsWith("data:"));for(const y of O){const A=y.replace(/^data:\s*/,"").trim();if(A!=="[DONE]")try{const E=JSON.parse(A).choices?.[0]?.delta?.content;E&&(S+=E,r(K=>K.map(w=>w.id===f?{...w,content:S}:w)))}catch{}}}i("api_latency_ms")}catch(x){b("system",`Error: ${x.message}`),r(p=>p.filter(v=>v.id!==f))}finally{h(!1)}},[t,d,l,o,b,n,i,r]);return e.jsx("div",{className:"h-screen flex flex-col bg-neutral-100",children:e.jsx("div",{className:"flex-1 flex justify-center p-6 overflow-hidden",children:e.jsxs("div",{className:"w-full max-w-[800px] bg-white rounded-3xl shadow-2xl flex flex-col overflow-hidden",children:[e.jsx(G,{messages:l}),e.jsx(F,{onSend:L,disabled:o})]})})})}export{re as default};
