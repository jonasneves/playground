import{r,j as e,F,d as L,u as I,S as T,X as P}from"./react-vendor-Cs3UoJXk.js";import{u as O}from"./index-DXJFSLEw.js";import{u as $}from"./usePerformanceMonitor-DujDrzqa.js";import{A as w}from"./main-BKxJeJkg.js";import"./vendor-7OC5HNn7.js";import"./state-CWLQzQDb.js";const j=r.memo(function({item:t,level:l,isOpen:i,isSelected:c,onToggle:f,onSelect:n}){return t.type==="dir"?e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 hover:bg-neutral-100 cursor-pointer text-sm text-neutral-700 transition-colors",style:{paddingLeft:`${l*16+16}px`},onClick:f,children:[e.jsx(F,{size:16,className:i?"text-brand-600":""}),e.jsx("span",{className:"font-medium",children:t.name})]}):e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1.5 hover:bg-neutral-100 cursor-pointer text-sm transition-colors ${c?"bg-brand-50 text-brand-700":"text-neutral-600"}`,style:{paddingLeft:`${l*16+16}px`},onClick:n,children:[e.jsx(L,{size:16}),e.jsx("span",{children:t.name})]})});function _({files:o,onFileSelect:t,selectedFile:l,onLoadDirectory:i}){const[c,f]=r.useState({}),n=r.useCallback(async s=>{f(x=>{const a=x[s.path]||{isOpen:!1,children:[],isLoaded:!1};return a.isOpen?{...x,[s.path]:{...a,isOpen:!1}}:a.isLoaded?{...x,[s.path]:{...a,isOpen:!0}}:(i(s.path).then(u=>{f(h=>({...h,[s.path]:{isOpen:!0,children:u,isLoaded:!0}}))}),x)})},[i]),p=r.useCallback((s,x=0)=>{const a=s.type==="dir",u=c[s.path],h=u?.isOpen||!1,b=l?.path===s.path;return a?e.jsxs("div",{children:[e.jsx(j,{item:s,level:x,isOpen:h,isSelected:!1,onToggle:()=>n(s)}),h&&u?.children?.length>0&&e.jsx("div",{children:u.children.map(g=>p(g,x+1))})]},s.path):e.jsx(j,{item:s,level:x,isOpen:!1,isSelected:b,onSelect:()=>t(s)},s.path)},[c,l,n,t]);return e.jsx("div",{children:o.map(s=>p(s))})}function M({content:o,onChange:t,disabled:l,placeholder:i}){const c=r.useRef(null);return r.useEffect(()=>{o&&c.current&&c.current.focus()},[o]),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Editor"}),e.jsx("textarea",{ref:c,id:"editor",value:o,onChange:f=>t(f.target.value),disabled:l,placeholder:i||"Select a file to edit...",className:"flex-1 w-full px-6 py-4 font-mono text-sm text-neutral-900 resize-none focus:outline-none disabled:bg-neutral-50 disabled:text-neutral-400"})]})}function z(){const[o,t]=r.useState(""),[l,i]=r.useState(!1),[c,f]=r.useState(null),n=r.useRef(null),p=r.useRef(0),s=r.useRef(null);r.useEffect(()=>{const a=new Worker(new URL(""+new URL("markdown.worker-Dti5hhgv.js",import.meta.url).href,import.meta.url),{type:"module"});return a.onmessage=u=>{const{id:h,html:b,error:g}=u.data;if(h==="ready"){i(!0);return}s.current===h&&(g?f(g):(t(b),f(null)),s.current=null)},a.onerror=u=>{console.error("Markdown worker error:",u),f("Worker error occurred"),i(!1)},n.current=a,()=>{a.terminate()}},[]);const x=r.useCallback(a=>{if(!n.current||!l)return;const u=`request-${++p.current}`;s.current=u;const h={id:u,markdown:a};n.current.postMessage(h)},[l]);return{html:o,parse:x,isReady:l,error:c}}function W(o,t){const[l,i]=r.useState(o);return r.useEffect(()=>{const c=setTimeout(()=>{i(o)},t);return()=>{clearTimeout(c)}},[o,t]),l}function A({content:o,isMarkdown:t}){const{html:l,parse:i,isReady:c,error:f}=z(),n=W(o,300);return r.useEffect(()=>{t&&c&&n&&i(n)},[n,t,c,i]),t?f?e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"text-center text-red-600 py-8",children:["Error: ",f]})})]}):o?e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:l}})]}):e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"Preview will appear here for markdown files"})})]}):e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"Preview available for markdown files only"})})]})}function X(){const o=I(),t=O(w.repository.owner,w.repository.name),{startTimer:l,endTimer:i}=$("cms"),[c,f]=r.useState([]),[n,p]=r.useState(null),[s,x]=r.useState(""),[a,u]=r.useState(!1),[h,b]=r.useState(!1),[g,v]=r.useState(!0),y=r.useCallback(d=>d.filter(m=>!m.name.startsWith(".")&&m.name!=="node_modules"),[]);r.useEffect(()=>{N()},[]);const N=async()=>{try{v(!0);const d=await t.listDirectory("");f(y(d))}catch(d){console.error("Error loading directory:",d),alert(`Error: ${d.message}`)}finally{v(!1)}},S=r.useCallback(async d=>{try{const m=await t.listDirectory(d);return y(m)}catch(m){return console.error("Error loading directory:",m),[]}},[t,y]),C=r.useCallback(async d=>{if(d.type!=="dir"&&!(a&&!confirm("You have unsaved changes. Discard them?")))try{const m=await t.getFile(d.path);p(m),x(m.content),u(!1)}catch(m){alert(`Error loading file: ${m.message}`)}},[t,a]),k=r.useCallback(d=>{x(d),u(!0)},[]),R=r.useCallback(async()=>{if(!(!n||!a)){b(!0);try{l("save_latency_ms");const d=`Update ${n.path.split("/").pop()}`;await t.updateFile(n.path,s,n.sha,d);const m=await t.getFile(n.path);i("save_latency_ms"),p(m),u(!1),alert("Saved successfully!")}catch(d){alert(`Error saving: ${d.message}`)}finally{b(!1)}}},[n,s,a,t,l,i]),D=()=>{a&&!confirm("You have unsaved changes. Close anyway?")||o("/")},E=n?.path.endsWith(".md")||!1;return e.jsxs("div",{className:"flex flex-col h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"Content Manager"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors disabled:bg-neutral-300 disabled:cursor-not-allowed",onClick:R,disabled:!a||h,children:[e.jsx(T,{size:16}),h?"Saving...":"Save"]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:D,children:[e.jsx(P,{size:16}),"Close"]})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-64 bg-white border-r border-neutral-200 overflow-y-auto",children:[e.jsx("div",{className:"px-4 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Repository Files"}),g?e.jsx("div",{className:"p-5 text-center text-neutral-400",children:"Loading..."}):e.jsx(_,{files:c,onFileSelect:C,selectedFile:n?{...n,type:"file"}:null,onLoadDirectory:S})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(M,{content:s,onChange:k,disabled:!n}),e.jsx(A,{content:s,isMarkdown:E})]})]})]})}export{X as default};
