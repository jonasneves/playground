import{j as e,r as l,F as w,i as F}from"./react-vendor-ZSESqh15.js";import{u as S}from"./index-BFxOuUu2.js";import{u as E}from"./usePerformanceMonitor-JdkSPsrY.js";import{b as I,A as L}from"./index-CTPJhRwG.js";import"./vendor-7OC5HNn7.js";import"./state-CWLQzQDb.js";function C({currentPath:t,onNavigate:n}){const s=[{name:"root",path:""}];if(t){const r=t.split("/").filter(Boolean);let o="";for(const a of r)o=o?`${o}/${a}`:a,s.push({name:a,path:o})}return e.jsx("div",{className:"flex items-center gap-2 px-4 py-3 mb-4 bg-white rounded-lg border border-neutral-200 text-sm",children:s.map((r,o)=>e.jsxs("span",{className:"flex items-center gap-2",children:[o>0&&e.jsx("span",{className:"text-neutral-400",children:"/"}),e.jsx("a",{href:"#",onClick:a=>{a.preventDefault(),n(r.path)},className:"text-brand-600 hover:text-brand-700 hover:underline transition-colors",children:r.name})]},r.path))})}function T(t){return t?t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`:""}function B(t){return[...t].sort((n,s)=>n.type===s.type?n.name.localeCompare(s.name):n.type==="dir"?-1:1)}const v=l.memo(({file:t,onNavigate:n,style:s})=>{const r=t.type==="dir",o=r?e.jsx(w,{size:20}):e.jsx(F,{size:20}),a=r?"":T(t.size),c=()=>{r&&n(t.path)};return e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 border-b border-neutral-100 last:border-b-0 ${r?"cursor-pointer hover:bg-neutral-50 transition-colors":""}`,onClick:c,style:s,children:[e.jsx("span",{className:`flex-shrink-0 ${r?"text-brand-600":"text-neutral-400"}`,children:o}),e.jsx("span",{className:"flex-1 text-sm text-neutral-900 truncate",children:t.name}),a&&e.jsx("span",{className:"flex-shrink-0 text-xs text-neutral-500",children:a})]})});v.displayName="FileListItem";const u=56,N=5,H=l.memo(function({file:n,index:s,onNavigate:r}){return e.jsx(v,{file:n,onNavigate:r,style:{position:"absolute",top:s*u,left:0,right:0,height:u}})});function k({files:t,onNavigate:n}){const s=l.useRef(null),[r,o]=l.useState(0),[a,c]=l.useState(600);l.useEffect(()=>{if(!s.current)return;const i=()=>{s.current&&c(s.current.clientHeight)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const d=i=>{o(i.currentTarget.scrollTop)},f=t.length*u,x=Math.max(0,Math.floor(r/u)-N),m=Math.min(t.length,Math.ceil((r+a)/u)+N),h=t.slice(x,m);return t.length<100?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden",children:t.map(i=>e.jsx(v,{file:i,onNavigate:n},i.path))}):e.jsx("div",{ref:s,className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-auto",onScroll:d,style:{height:"600px"},children:e.jsx("div",{style:{height:f,position:"relative"},children:h.map((i,p)=>{const b=x+p;return e.jsx(H,{file:i,index:b,onNavigate:n},i.path)})})})}function D(){const{repository:t}=I(),n=t||L.repository,s=S(n.owner,n.name),{startTimer:r,endTimer:o}=E("file-browser"),[a,c]=l.useState(""),[d,f]=l.useState([]),[x,m]=l.useState(!0),[h,i]=l.useState(null);l.useEffect(()=>{p(a)},[a]);const p=async g=>{try{m(!0),i(null),r("directory_load_ms");const j=await s.listDirectory(g),y=B(j);o("directory_load_ms"),f(y)}catch(j){i(j.message)}finally{m(!1)}},b=l.useCallback(g=>{c(g)},[]);return x&&d.length===0?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"bg-white border-b border-neutral-200 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"})}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading files..."})})]}):h?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"bg-white border-b border-neutral-200 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"})}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center text-red-600 py-8",children:["Error: ",h,e.jsx("br",{}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors",onClick:()=>p(a),children:"Retry"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"bg-white border-b border-neutral-200 px-6 py-4",children:e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"})}),e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[e.jsx(C,{currentPath:a,onNavigate:b}),x?e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading..."}):d.length===0?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"This directory is empty"})}):e.jsx(k,{files:d,onNavigate:b})]})]})}export{D as default};
