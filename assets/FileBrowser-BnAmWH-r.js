import{j as e,r as l,F,d as k,u as B}from"./react-vendor-Cs3UoJXk.js";import{u as C}from"./index-BpOy3AOe.js";import{u as S}from"./usePerformanceMonitor-BFQgTTPT.js";import{A as y}from"./main-BBCBgpjG.js";import"./vendor-7OC5HNn7.js";import"./state-CWLQzQDb.js";function E({currentPath:t,onNavigate:a}){const s=[{name:"root",path:""}];if(t){const r=t.split("/").filter(Boolean);let n="";for(const o of r)n=n?`${n}/${o}`:o,s.push({name:o,path:n})}return e.jsx("div",{className:"flex items-center gap-2 px-4 py-3 mb-4 bg-white rounded-lg border border-neutral-200 text-sm",children:s.map((r,n)=>e.jsxs("span",{className:"flex items-center gap-2",children:[n>0&&e.jsx("span",{className:"text-neutral-400",children:"/"}),e.jsx("a",{href:"#",onClick:o=>{o.preventDefault(),a(r.path)},className:"text-brand-600 hover:text-brand-700 hover:underline transition-colors",children:r.name})]},r.path))})}function I(t){return t?t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`:""}function L(t){return[...t].sort((a,s)=>a.type===s.type?a.name.localeCompare(s.name):a.type==="dir"?-1:1)}const v=l.memo(({file:t,onNavigate:a,style:s})=>{const r=t.type==="dir",n=r?e.jsx(F,{size:20}):e.jsx(k,{size:20}),o=r?"":I(t.size),c=()=>{r&&a(t.path)};return e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 border-b border-neutral-100 last:border-b-0 ${r?"cursor-pointer hover:bg-neutral-50 transition-colors":""}`,onClick:c,style:s,children:[e.jsx("span",{className:`flex-shrink-0 ${r?"text-brand-600":"text-neutral-400"}`,children:n}),e.jsx("span",{className:"flex-1 text-sm text-neutral-900 truncate",children:t.name}),o&&e.jsx("span",{className:"flex-shrink-0 text-xs text-neutral-500",children:o})]})});v.displayName="FileListItem";const u=56,N=5,T=l.memo(function({file:a,index:s,onNavigate:r}){return e.jsx(v,{file:a,onNavigate:r,style:{position:"absolute",top:s*u,left:0,right:0,height:u}})});function H({files:t,onNavigate:a}){const s=l.useRef(null),[r,n]=l.useState(0),[o,c]=l.useState(600);l.useEffect(()=>{if(!s.current)return;const i=()=>{s.current&&c(s.current.clientHeight)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const f=i=>{n(i.currentTarget.scrollTop)},m=t.length*u,d=Math.max(0,Math.floor(r/u)-N),h=Math.min(t.length,Math.ceil((r+o)/u)+N),p=t.slice(d,h);return t.length<100?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden",children:t.map(i=>e.jsx(v,{file:i,onNavigate:a},i.path))}):e.jsx("div",{ref:s,className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-auto",onScroll:f,style:{height:"600px"},children:e.jsx("div",{style:{height:m,position:"relative"},children:p.map((i,b)=>{const x=d+b;return e.jsx(T,{file:i,index:x,onNavigate:a},i.path)})})})}function A(){const t=B(),a=C(y.repository.owner,y.repository.name),{startTimer:s,endTimer:r}=S("file-browser"),[n,o]=l.useState(""),[c,f]=l.useState([]),[m,d]=l.useState(!0),[h,p]=l.useState(null);l.useEffect(()=>{i(n)},[n]);const i=async g=>{try{d(!0),p(null),s("directory_load_ms");const j=await a.listDirectory(g),w=L(j);r("directory_load_ms"),f(w)}catch(j){p(j.message)}finally{d(!1)}},b=l.useCallback(g=>{o(g)},[]),x=()=>{t("/")};return m&&c.length===0?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"}),e.jsx("button",{className:"px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:x,children:"← Back to Gallery"})]}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading files..."})})]}):h?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"}),e.jsx("button",{className:"px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:x,children:"← Back to Gallery"})]}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center text-red-600 py-8",children:["Error: ",h,e.jsx("br",{}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors",onClick:()=>i(n),children:"Retry"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"}),e.jsx("button",{className:"px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:x,children:"← Back to Gallery"})]}),e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[e.jsx(E,{currentPath:n,onNavigate:b}),m?e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading..."}):c.length===0?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"This directory is empty"})}):e.jsx(H,{files:c,onNavigate:b})]})]})}export{A as default};
