import{r as c}from"./react-vendor-wgB0DCIy.js";import{c as T,u as j}from"./index-qQk8yOig.js";function U(b,g){return function(o,r){const C=b.token,{getCache:m,setCache:y,invalidateCache:l}=g,f=`https://api.github.com/repos/${o}/${r}`,u=c.useCallback(t=>btoa(unescape(encodeURIComponent(t))),[]),d=c.useCallback(t=>decodeURIComponent(escape(atob(t))),[]),a=c.useCallback(async(t,e={},n)=>{const s=await fetch(`${f}/contents/${t}`,{...e,signal:n||e.signal,headers:{Authorization:`Bearer ${C}`,Accept:"application/vnd.github.v3+json",...e.headers}});if(!s.ok)throw s.status===401?(b.logout(),new Error("Authentication expired")):new Error(`Failed to ${e.method||"fetch"} ${t}: ${s.statusText}`);return s.json()},[f,C]),h=c.useCallback(async(t,e)=>{const n=m(o,r,t);if(n)return{content:n.content,sha:n.sha,path:t};const s=await a(t,{},e),i={content:d(s.content),sha:s.sha,path:s.path,name:s.name,size:s.size};return y(o,r,t,i.content,i.sha),i},[o,r,m,y,a,d]),k=c.useCallback(async(t,e,n,s,i)=>{const S=await a(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s||`Update ${t}`,content:u(e),sha:n})},i);return l(o,r,t),S},[o,r,a,u,l]),$=c.useCallback(async(t,e,n,s)=>a(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n||`Create ${t}`,content:u(e)})},s),[a,u]),p=c.useCallback(async(t,e,n,s)=>{const i=await a(t,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n||`Delete ${t}`,sha:e})},s);return l(o,r,t),i},[o,r,a,l]),A=c.useCallback(async(t="",e)=>a(t,{},e),[a]),E=c.useCallback(async(t,e)=>{try{const n=await h(`${t}/manifest.json`,e);return JSON.parse(n.content)}catch(n){if(n.name==="AbortError")throw n;return null}},[h]);return{getFile:h,updateFile:k,createFile:$,deleteFile:p,listDirectory:A,getManifest:E,encodeContent:u,decodeContent:d}}}const x=U(j.getState(),T.getState());export{x as u};
