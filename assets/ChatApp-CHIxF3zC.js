import{j as t,u as S}from"./main-CNCu5yuJ.js";import{r as a}from"./state-DOKsaQ-a.js";import{A as C}from"./ui-D_bnl3Nn.js";import{u as A}from"./usePerformanceMonitor-CQRhZHFI.js";import"./vendor-CZvkgD4c.js";const w=a.memo(({message:e,style:r})=>e.role==="user"?t.jsx("div",{style:r,className:"flex justify-end","data-role":e.role,children:t.jsx("div",{className:"px-5 py-3 rounded-2xl rounded-br-sm bg-[#00539B] text-white text-[15px] leading-relaxed max-w-[85%] shadow-sm",children:e.content})}):e.role==="assistant"?t.jsxs("div",{style:r,className:"flex gap-3","data-role":e.role,children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-[#00539B]/10 flex items-center justify-center flex-shrink-0",children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",className:"text-[#00539B]",children:t.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})}),t.jsx("div",{className:"px-5 py-3 rounded-2xl rounded-tl-sm bg-white border border-neutral-200 text-neutral-700 text-[15px] leading-relaxed max-w-[85%] shadow-sm",children:e.content})]}):t.jsx("div",{style:r,className:"flex justify-center","data-role":e.role,children:t.jsx("div",{className:"px-4 py-2 rounded-lg bg-amber-50 border border-amber-200 text-amber-800 text-sm text-center max-w-[85%]",children:e.content})}));w.displayName="MessageBubble";function M({messages:e}){const r=a.useRef(null),c=a.useRef(!0);a.useEffect(()=>{c.current&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[e]);const n=()=>{if(!r.current)return;const{scrollTop:s,scrollHeight:i,clientHeight:o}=r.current,l=Math.abs(i-o-s)<50;c.current=l};return t.jsx("div",{ref:r,className:"flex-1 overflow-y-auto px-6 py-6",id:"chat",onScroll:n,children:e.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-8",children:[t.jsx("div",{className:"w-20 h-20 bg-[#00539B]/10 rounded-3xl flex items-center justify-center mb-6",children:t.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-[#00539B]",children:t.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})}),t.jsx("h2",{className:"text-xl font-bold text-neutral-900 mb-2",children:"AI Chat"}),t.jsx("p",{className:"text-sm text-neutral-500 max-w-sm",children:"Start a conversation with AI models powered by GitHub"})]}):t.jsx("div",{className:"space-y-4",children:e.map((s,i)=>t.jsx(w,{message:s},s.id||i))})})}function k({onSend:e,disabled:r}){const[c,n]=a.useState(""),s=a.useRef(null);a.useEffect(()=>{r||s.current?.focus()},[r]);const i=()=>{const l=c.trim();!l||r||(e(l),n(""),s.current?.focus())},o=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),i())};return t.jsx("div",{className:"px-6 py-5 bg-white border-t border-neutral-100",children:t.jsxs("div",{className:"flex items-center gap-2 px-5 py-2 bg-neutral-50 border border-neutral-200 rounded-[28px] transition-all focus-within:border-[#00539B] focus-within:shadow-[0_0_0_3px_rgba(0,83,155,0.1)]",children:[t.jsx("input",{ref:s,type:"text",id:"input",value:c,onChange:l=>n(l.target.value),onKeyDown:o,placeholder:"Type a message...",disabled:r,className:"flex-1 py-2 bg-transparent border-none text-[15px] text-neutral-900 placeholder-neutral-400 focus:outline-none disabled:text-neutral-400"}),t.jsx("button",{onClick:i,disabled:r||!c.trim(),id:"send-btn",className:"w-10 h-10 flex items-center justify-center bg-[#00539B] hover:bg-[#012169] text-white rounded-full transition-colors disabled:bg-neutral-300 disabled:cursor-not-allowed flex-shrink-0","aria-label":"Send message",children:t.jsx(C,{size:18})})]})})}const E=[{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"meta-llama-3.1-70b-instruct",label:"Llama 3.1 70B"},{value:"mistral-large",label:"Mistral Large"}];function B({selectedModel:e,onModelChange:r,onClearChat:c}){return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("select",{id:"model",value:e,onChange:n=>r(n.target.value),className:"px-3 py-1.5 text-xs bg-white/10 text-white border border-white/20 rounded-full focus:outline-none focus:bg-white/20 transition-colors",children:E.map(n=>t.jsx("option",{value:n.value,className:"text-neutral-900",children:n.label},n.value))}),t.jsx("button",{onClick:c,className:"px-3 py-1.5 text-xs text-white/80 hover:text-white hover:bg-white/10 rounded-full transition-colors",children:"Clear"})]})}function I(e,r={}){const{maxBatchSize:c=1/0}=r,n=a.useRef([]),s=a.useRef(void 0),i=a.useCallback(l=>{const d=Array.isArray(l)?l:[l];if(n.current.push(...d),n.current.length>=c){s.current!==void 0&&(cancelAnimationFrame(s.current),s.current=void 0),e(n.current),n.current=[];return}s.current||(s.current=requestAnimationFrame(()=>{e(n.current),n.current=[],s.current=void 0}))},[e,c]),o=a.useCallback(()=>{s.current!==void 0&&(cancelAnimationFrame(s.current),s.current=void 0),n.current.length>0&&(e(n.current),n.current=[])},[e]);return a.useEffect(()=>()=>{s.current!==void 0&&cancelAnimationFrame(s.current)},[]),{accumulate:i,flush:o}}function g(e,r){const[c,n]=a.useState(()=>{try{const o=window.localStorage.getItem(e);return o?JSON.parse(o):r}catch(o){return console.warn(`Error reading localStorage key "${e}":`,o),r}}),s=a.useCallback(o=>{try{n(l=>{const d=o instanceof Function?o(l):o;return window.localStorage.setItem(e,JSON.stringify(d)),d})}catch(l){console.warn(`Error setting localStorage key "${e}":`,l)}},[e]),i=a.useCallback(()=>{try{window.localStorage.removeItem(e),n(r)}catch(o){console.warn(`Error removing localStorage key "${e}":`,o)}},[e,r]);return[c,s,i]}function D(){const e=S(x=>x.token),{startTimer:r,endTimer:c}=A("chat"),[n,s,i]=g("chat_history",[]),[o,l]=g("chat_model","gpt-4o-mini"),[d,m]=a.useState(!1);a.useEffect(()=>{c("ttfr")},[c]);const v=a.useCallback(x=>{s(u=>[...u,...x])},[s]),{accumulate:p}=I(v),h=a.useCallback((x,u)=>{const b={role:x,content:u,id:`${Date.now()}-${Math.random()}`};p(b)},[p]),j=a.useCallback(async x=>{if(!(!e||d)){m(!0),h("user",x);try{r("api_latency_ms");const u=await fetch("https://models.inference.ai.azure.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:o,messages:[...n,{role:"user",content:x}].map(f=>({role:f.role,content:f.content})),temperature:.7,max_tokens:1e3})});if(!u.ok){const f=await u.json().catch(()=>({error:{message:`API error: ${u.status}`}}));throw new Error(f.error?.message||`API error: ${u.status}`)}const N=(await u.json()).choices[0].message.content;c("api_latency_ms"),h("assistant",N)}catch(u){h("system",`Error: ${u.message}`)}finally{m(!1)}}},[e,o,n,d,h,r,c]),y=a.useCallback(()=>{confirm("Clear all chat history?")&&i()},[i]);return t.jsxs("div",{className:"h-screen flex flex-col bg-[#E2E6ED]",children:[t.jsxs("div",{className:"bg-[#012169] px-6 py-3.5 flex items-center justify-between",children:[t.jsx("h1",{className:"text-lg font-bold text-white",children:"AI Chat"}),t.jsx(B,{selectedModel:o,onModelChange:l,onClearChat:y})]}),t.jsx("div",{className:"flex-1 flex justify-center p-6 overflow-hidden",children:t.jsxs("div",{className:"w-full max-w-[800px] bg-white rounded-3xl shadow-2xl flex flex-col overflow-hidden",children:[t.jsx(M,{messages:n}),t.jsx(k,{onSend:j,disabled:d})]})})]})}export{D as default};
