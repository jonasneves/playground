import{j as l,u as C}from"./main-DpeyGvqJ.js";import{r as c}from"./state-DOKsaQ-a.js";import{u as M}from"./usePerformanceMonitor-DA_KCYB2.js";import"./vendor-CZvkgD4c.js";const v=c.memo(({message:e,style:r})=>l.jsx("div",{style:r,className:`message ${e.role}`,"data-role":e.role,children:e.content}));v.displayName="MessageBubble";function w({messages:e}){const r=c.useRef(null),a=c.useRef(!0);c.useEffect(()=>{a.current&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[e]);const t=()=>{if(!r.current)return;const{scrollTop:n,scrollHeight:i,clientHeight:s}=r.current,o=Math.abs(i-s-n)<50;a.current=o};return l.jsx("div",{ref:r,className:"chat-container",id:"chat",onScroll:t,children:e.map((n,i)=>l.jsx(v,{message:n},n.id||i))})}function A({onSend:e,disabled:r}){const[a,t]=c.useState(""),n=c.useRef(null);c.useEffect(()=>{r||n.current?.focus()},[r]);const i=()=>{const o=a.trim();!o||r||(e(o),t(""),n.current?.focus())},s=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),i())};return l.jsxs("div",{className:"input-container",children:[l.jsx("input",{ref:n,type:"text",id:"input",value:a,onChange:o=>t(o.target.value),onKeyPress:s,placeholder:"Type your message...",disabled:r}),l.jsx("button",{onClick:i,disabled:r||!a.trim(),id:"send-btn",children:"Send"})]})}const E=[{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"meta-llama-3.1-70b-instruct",label:"Llama 3.1 70B"},{value:"mistral-large",label:"Mistral Large"}];function R({selectedModel:e,onModelChange:r,onClearChat:a}){return l.jsxs("div",{className:"model-selector",children:[l.jsx("label",{htmlFor:"model",children:"Model:"}),l.jsx("select",{id:"model",value:e,onChange:t=>r(t.target.value),children:E.map(t=>l.jsx("option",{value:t.value,children:t.label},t.value))}),l.jsx("button",{onClick:a,style:{marginLeft:"auto",padding:"6px 12px",fontSize:"13px"},children:"Clear Chat"})]})}function k(e,r={}){const{maxBatchSize:a=1/0}=r,t=c.useRef([]),n=c.useRef(void 0),i=c.useCallback(o=>{const m=Array.isArray(o)?o:[o];if(t.current.push(...m),t.current.length>=a){n.current!==void 0&&(cancelAnimationFrame(n.current),n.current=void 0),e(t.current),t.current=[];return}n.current||(n.current=requestAnimationFrame(()=>{e(t.current),t.current=[],n.current=void 0}))},[e,a]),s=c.useCallback(()=>{n.current!==void 0&&(cancelAnimationFrame(n.current),n.current=void 0),t.current.length>0&&(e(t.current),t.current=[])},[e]);return c.useEffect(()=>()=>{n.current!==void 0&&cancelAnimationFrame(n.current),t.current.length>0&&e(t.current)},[e]),{accumulate:i,flush:s}}function S(e,r){const[a,t]=c.useState(()=>{try{const s=window.localStorage.getItem(e);return s?JSON.parse(s):r}catch(s){return console.warn(`Error reading localStorage key "${e}":`,s),r}}),n=c.useCallback(s=>{try{const o=s instanceof Function?s(a):s;t(o),window.localStorage.setItem(e,JSON.stringify(o))}catch(o){console.warn(`Error setting localStorage key "${e}":`,o)}},[e,a]),i=c.useCallback(()=>{try{window.localStorage.removeItem(e),t(r)}catch(s){console.warn(`Error removing localStorage key "${e}":`,s)}},[e,r]);return[a,n,i]}function P(){const e=C(d=>d.token),{startTimer:r,endTimer:a}=M("chat"),[t,n,i]=S("chat_history",[]),[s,o]=S("chat_model","gpt-4o-mini"),[m,p]=c.useState(!1);c.useEffect(()=>{a("ttfr")},[a]);const{accumulate:g}=k(d=>{n(u=>[...u,...d])}),f=c.useCallback((d,u)=>{const x={role:d,content:u,id:`${Date.now()}-${Math.random()}`};g(x)},[g]),y=c.useCallback(async d=>{if(!(!e||m)){p(!0),f("user",d);try{r("api_latency_ms");const u=await fetch("https://models.inference.ai.azure.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:s,messages:[...t,{role:"user",content:d}].map(h=>({role:h.role,content:h.content})),temperature:.7,max_tokens:1e3})});if(!u.ok){const h=await u.json().catch(()=>({error:{message:`API error: ${u.status}`}}));throw new Error(h.error?.message||`API error: ${u.status}`)}const j=(await u.json()).choices[0].message.content;a("api_latency_ms"),f("assistant",j)}catch(u){f("system",`Error: ${u.message}`)}finally{p(!1)}}},[e,s,t,m,f,r,a]),b=c.useCallback(()=>{confirm("Clear all chat history?")&&i()},[i]);return l.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[l.jsxs("div",{className:"header",children:[l.jsx("h1",{children:"AI Chat"}),l.jsx("p",{children:"Powered by GitHub Models"})]}),l.jsx(R,{selectedModel:s,onModelChange:o,onClearChat:b}),l.jsx(w,{messages:t}),l.jsx(A,{onSend:y,disabled:m})]})}export{P as default};
